<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XAU/USD â€” COT Disaggregated (Gold 088691) â€“ Rapport & Plan</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
  :root{
    --bg:#0f1115; --panel:#151923; --ink:#eef1f7; --muted:#9aa3b2;
    --accent:#59c3ff; --ok:#23c55e; --warn:#f59e0b; --bad:#ef4444;
    --card:#0f172a; --soft:#0b1220; --line:#212637;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:1100px;margin:auto;padding:24px}
  h1{font-size:24px;margin:0 0 12px}
  h2{font-size:18px;margin:0 0 8px}
  .row{display:grid;gap:14px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:1fr 1fr 1fr}
  .card{background:linear-gradient(180deg,var(--panel),var(--soft));border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.25)}
  .card .hd{padding:14px 16px;border-bottom:1px solid var(--line)}
  .card .bd{padding:14px 16px}
  label{display:block;color:var(--muted);margin:0 0 6px}
  textarea,input{width:100%;box-sizing:border-box;background:#0b1220;border:1px solid #1c2435;color:var(--ink);padding:10px;border-radius:10px;outline:none}
  textarea:focus,input:focus{border-color:#304063}
  textarea{min-height:160px;resize:vertical}
  .btns{display:flex;flex-wrap:wrap;gap:8px}
  button{background:#1e293b;color:#e9eef9;border:1px solid #2b3b57;padding:9px 12px;border-radius:10px;cursor:pointer}
  button:hover{filter:brightness(1.1)}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#0e1526}
  .ok{color:#b7f7c7;border-color:#1e3a2f;background:#0a1a12}
  .bad{color:#ffc2c2;border-color:#40222a;background:#1a0d10}
  .warn{color:#ffe8b5;border-color:#463719;background:#1a1308}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #1e2534;text-align:right}
  th:first-child,td:first-child{text-align:left}
  thead th{position:sticky;top:0;background:#0c1322;z-index:1}
  .kpis{display:flex;flex-wrap:wrap;gap:8px}
  .muted{color:var(--muted)}
  .gridRS{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .box{border:1px dashed #2a3652;border-radius:12px;padding:10px}
  .print-chunk{page-break-inside:avoid}
  .hint{font-size:12px;color:#aab2c2}
  @media print{
    body{background:#fff;color:#000}
    .card{background:#fff;border-color:#ddd;box-shadow:none}
    .no-print{display:none!important}
    .wrap{max-width:none;padding:0}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>ðŸ§  XAU/USD â€” Lecteur & Analyseur COT (Disaggregated, Gold 088691)</h1>
  <div class="btns no-print" style="margin-bottom:10px">
    <button id="btnAnalyse">Analyser</button>
    <button id="btnExportPDF">Exporter PDF</button>
    <button id="btnSave">Sauvegarder Ã©tat</button>
    <button id="btnLoad">Restaurer Ã©tat</button>
  </div>

  <div class="row g2">
    <div class="card print-chunk">
      <div class="hd"><h2>EntrÃ©e â€” Rapport COT (Semaine en cours)</h2></div>
      <div class="bd">
        <label>Colle le bloc texte CFTC (Disaggregated â€“ GOLD COMEX 088691). La ligne Â« All : â€¦ Â» sera dÃ©tectÃ©e automatiquement.</label>
        <textarea id="curTxt" placeholder="Colle iciâ€¦"></textarea>
        <div class="row g2" style="margin-top:10px">
          <div>
            <label>Spot XAU/USD (optionnel)</label>
            <input id="spot" type="number" step="0.1" placeholder="ex: 2400.5" />
          </div>
          <div>
            <label>Historique MM Net (CSV facultatif : date,mm_net)</label>
            <textarea id="histCsv" placeholder="2023-09-01, 120000&#10;2023-09-08, 125500"></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="card print-chunk">
      <div class="hd"><h2>EntrÃ©e â€” Rapport COT (Semaine prÃ©cÃ©dente, S-1)</h2></div>
      <div class="bd">
        <label>Colle la semaine prÃ©cÃ©dente pour calculer Î” semaine/semaine (facultatif mais recommandÃ©).</label>
        <textarea id="prevTxt" placeholder="Colle iciâ€¦"></textarea>
        <p class="hint">Astuce : tu peux coller les blocs complets CFTC. Le parseur repÃ¨re automatiquement la ligne Â« All : â€¦ Â».</p>
      </div>
    </div>
  </div>

  <div id="report" class="print-chunk">
    <div class="card">
      <div class="hd"><h2>RÃ©sumÃ© exÃ©cutif & KPIs</h2></div>
      <div class="bd">
        <div id="resume" style="margin-bottom:10px" class="muted">Colle tes rapports puis clique Â« Analyser Â».</div>
        <div class="kpis" id="kpis"></div>
      </div>
    </div>
  </div>

  <div class="row g2 print-chunk" style="margin-top:14px">
    <div class="card">
      <div class="hd"><h2>Lecture COT â€” Tableau</h2></div>
      <div class="bd">
        <div class="hint" style="margin-bottom:8px">Colonnes : Long / Short / Net et Î” (Sâˆ’S-1). CatÃ©gories : Managed Money, Swap Dealers, Producer/Merchant, Other Reportables, Non-reportables + Open Interest.</div>
        <div style="overflow:auto"><table id="tableCot"></table></div>
      </div>
    </div>
    <div class="card">
      <div class="hd"><h2>Niveaux & ScÃ©narios (H4/D1)</h2></div>
      <div class="bd">
        <div id="rsBox" class="gridRS" style="margin-bottom:10px"></div>
        <div class="box">
          <b>ScÃ©narios</b>
          <ul>
            <li><b>Haussier</b> â€” Î” MM Net & OI positifs ; break & hold au-dessus R1 â†’ viser R2/R3. Invalidation : perte de S1 + MM Net â†“.</li>
            <li><b>Range</b> â€” MM Net stable (Â±5â€“10k) ; travailler S1â†”R1 ; Ã©viter milieu sans signal clair.</li>
            <li><b>Cassure baissiÃ¨re</b> â€” Î” MM Net & OI nÃ©gatifs ; cassure S1/S2 avec BOS H4 â†’ shorts tactiques au pullback.</li>
          </ul>
          <div class="hint">ExÃ©cution : fenÃªtres Europe 08:00â€“11:00 & 13:00â€“16:00, triggers OB/FVG/SMT, RR â‰¥ 1:2.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g2 print-chunk" style="margin-top:14px">
    <div class="card">
      <div class="hd"><h2>Graphique â€” Managed Money (Long/Short/Net)</h2></div>
      <div class="bd"><canvas id="chartBars" height="260"></canvas></div>
    </div>
    <div class="card">
      <div class="hd"><h2>Graphique â€” MM Net S-1 vs S (explication S/S-1)</h2></div>
      <div class="bd">
        <div class="hint" style="margin-bottom:8px"><b>S</b> = semaine actuelle (dernier rapport) â€¢ <b>S-1</b> = semaine prÃ©cÃ©dente. Î” = S âˆ’ S-1.</div>
        <canvas id="chartDelta" height="260"></canvas>
      </div>
    </div>
  </div>

  <div class="card print-chunk" style="margin-top:14px">
    <div class="hd"><h2>Agenda macro â€” remplissage rapide & export ICS</h2></div>
    <div class="bd">
      <div class="btns no-print" style="margin-bottom:8px">
        <button id="btnFillAgenda">Remplir auto (rÃ¨gles)</button>
        <button id="btnExportICS">Exporter .ics</button>
      </div>
      <div class="row g3">
        <div><label>NFP (US)</label><input id="nfpDate" type="date"></div>
        <div><label>CPI (US)</label><input id="cpiDate" type="date"></div>
        <div><label>PCE core (US)</label><input id="pceDate" type="date"></div>
        <div><label>FOMC â€“ dÃ©but</label><input id="fomcStart" type="date"></div>
        <div><label>FOMC â€“ fin</label><input id="fomcEnd" type="date"></div>
        <div><label>Notes</label><input id="macroNotes" placeholder="Ex. : CPI>attendu â‡’ USDâ†‘ Orâ†“" /></div>
      </div>
      <p class="hint" style="margin-top:8px">Rappel : le COT est datÃ© du mardi et publiÃ© le vendredi â†’ filtre de biais hebdomadaire, <i>pas</i> un outil intraday.</p>
    </div>
  </div>
</div>

<script src="cot_analyzer.js"></script>
</body>
</html>
